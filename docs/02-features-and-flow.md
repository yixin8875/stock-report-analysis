# 功能与流程

## 1. 文章分析主流程

1. 导入文件（txt/md/html/pdf/office/图片）
2. 解析内容并入库 `articles`
3. 选择 AI 渠道与提示词
4. 执行单篇或批量分析
5. 保存结果到 `analysis_history` 与 `analysis_runs`
6. 在详情页查看历史和结构化结果

## 2. 问答（QA）流程

1. 基于文章创建问答会话 `qa_sessions`
2. 按角色并行/串行生成回复 `qa_messages`
3. 记录证据 `qa_evidences` 与运行指标 `qa_runs`
4. 支持追问、重命名会话、置顶要点

说明:

- 后端与服务层输出大量 `QA` 日志，便于在 `wails dev` 终端排查“提问中无响应”等问题
- 设置页支持角色模板与默认角色切换

## 3. 财联社新闻流程

1. 定时任务轮询 `https://m.cls.cn/telegraph`
2. 从页面 `__NEXT_DATA__` 提取滚动电报数据
3. 通过 `news_id` 去重导入文章
4. 自动执行新闻专用提示词解读
5. 计算影响分、方向、级别并写入 `telegraph_meta`
6. 按自选股池映射命中 `telegraph_watch_hits`
7. 生成 30 分钟摘要 `telegraph_digests`

## 4. 自选股映射逻辑

命中规则:

- 股票代码直接命中（6 位数字）
- 股票名称命中
- 别名命中（设置页可维护）

匹配目标:

- 新闻标题 + 正文

映射结果:

- 用于新闻页“仅看自选”和“自选优先”排序

## 5. 看板与运行指标

- 分析看板: 成功率、耗时、token、失败原因、按渠道统计
- 电报看板: 抓取数、导入数、解读数、失败原因
